# IAMI Streamlit UI 使用指南

## 📋 概述

IAMI Streamlit UI 是一个交互式 Web 界面，让你能够更方便地使用 IAMI 系统。

### 🎯 主要功能

1. **学习模式** 📚 - AI 通过对话了解你的思维模式
2. **模拟模式** 💬 - AI 以你的思维方式回答问题
3. **记忆浏览** 🗄️ - 查看已存储的记忆数据
4. **可视化** 📊 - 图形化展示你的特征和演变
5. **索引管理** ⚙️ - 管理 RAG 检索系统

## 🚀 快速开始

### 1. 安装依赖

```bash
# 安装所有依赖
pip install -r graphrag/requirements.txt
```

新增的 UI 相关依赖：
- `streamlit>=1.28.0` - Web 框架
- `streamlit-option-menu>=0.3.0` - 侧边栏菜单
- `plotly>=5.0.0` - 数据可视化（已包含）

### 2. 配置环境

在项目根目录创建 `.env` 文件：

```bash
# DeepSeek API (必需)
DEEPSEEK_API_KEY=your_api_key_here
DEEPSEEK_API_BASE=https://api.deepseek.com/v1
DEEPSEEK_MODEL=deepseek-chat

# Embedding Model
EMBEDDING_MODEL=text-embedding-3-small

# LightRAG 配置
GRAPHRAG_INDEX_DIR=./graphrag/storage/index

# ChromaDB 配置
CHROMA_PERSIST_DIR=./memory/vector_store
CHROMA_COLLECTION=iami_conversations
```

### 3. 启动应用

```bash
# 从项目根目录运行
streamlit run app.py
```

应用将在浏览器中自动打开，默认地址：`http://localhost:8501`

## 📖 详细功能说明

### 1. 首页 🏠

首页展示：
- 核心理念和功能介绍
- 学术框架说明
- 学习进度统计
- 快速入口按钮

#### 关键统计指标

- **已回答问题** - 累计对话次数
- **完成度** - 基于目标问题数的进度
- **涉及类别** - 已探索的维度
- **索引文档** - RAG 系统中的文档数

### 2. 学习模式 📚

通过对话了解你的思维模式。

#### 工作流程

1. **选择类别**（可选）
   - 自动选择 - 系统智能选择当前需要探索的维度
   - 手动选择 - 聚焦特定类别（性格、价值观等）

2. **生成问题**
   - 基于学术框架（Big Five、Schwartz Values 等）
   - 避免重复已问过的问题
   - 提供具体情境而非抽象问题

3. **回答问题**
   - 尽可能详细地回答
   - 分享真实经历和想法
   - 系统会自动分析你的回答

4. **查看分析**
   - 提取的特征（trait, value, evidence）
   - 置信度评分（1-5 星）
   - 建议的追问方向

5. **自动更新**
   - 更新记忆文件（personality.json, values.json 等）
   - 保存对话记录
   - 索引到 RAG 系统

#### 使用技巧

✅ **推荐做法**：
- 回答时分享具体例子和真实经历
- 表达你的真实想法，不要刻意迎合
- 如果问题不适合，可以跳过

❌ **避免**：
- 一两句话草草回答
- 给出假设性答案而非真实想法
- 担心"正确答案"（没有对错）

### 3. 模拟模式 💬

测试 AI 对你的理解程度。

#### 工作原理

1. AI 读取你的所有记忆
2. 根据你的性格、价值观、语言风格生成回答
3. 使用混合检索找到相关上下文

#### 使用方式

1. **提问** - 在聊天框输入任何问题
2. **查看回答** - AI 以你的思维方式回答
3. **检查详情** - 展开查看使用的记忆和检索上下文

#### 设置选项

- **只使用最新记忆** - 开启后，只使用最近的记忆快照，反映你当前的思想
- **关闭** - 使用所有历史记忆

#### 测试建议

尝试这些类型的问题：
- 价值观判断："你对 XX 的看法是什么？"
- 决策模拟："如果遇到 XX 情况，你会怎么做？"
- 立场测试:"你在 XX 问题上的立场是什么？"

### 4. 记忆浏览 🗄️

查看已存储的记忆数据。

#### 可浏览的记忆类型

| 类型 | 说明 | 文件路径 |
|------|------|---------|
| 性格特征 | Big Five 模型 | `memory/long_term/personality.json` |
| 价值观 | Schwartz 价值观 | `memory/long_term/values.json` |
| 思维模式 | 思考方式和习惯 | `memory/long_term/thinking_patterns.json` |
| 语言风格 | 表达习惯 | `memory/long_term/language_style.json` |
| 知识储备 | 知识领域 | `memory/long_term/knowledge.json` |
| 人际关系 | 关系网络 | `memory/relationships/network.json` |
| 时间轴 | 思想演变快照 | `memory/timeline/snapshots.json` |
| 对话记录 | 历史对话 | `memory/conversations/*.md` |

#### 数据格式

记忆数据使用 JSON 格式，带时间戳追踪演变：

```json
{
  "history": [
    {
      "timestamp": "2024-01-20T10:00:00",
      "trait": "Openness",
      "value": "高度开放",
      "evidence": "用户表示喜欢尝试新技术",
      "confidence": 4
    }
  ]
}
```

### 5. 可视化 📊

图形化展示你的特征和演变。

#### 可视化类型

1. **人物画像概览**
   - 综合展示核心特征
   - 自动生成画像（首次需手动触发）

2. **性格特征雷达图**
   - Big Five 五维图
   - 直观对比各维度分数

3. **价值观分布**
   - Schwartz 价值观类型统计
   - 条形图展示提及频率

4. **学习进度**
   - 各类别问题分布
   - 完成度进度条

5. **时间演变趋势**
   - 时间轴快照展示
   - 追踪思想变化（功能开发中）

### 6. 索引管理 ⚙️

管理 RAG 检索系统。

#### 统计信息

查看两个索引器的状态：

**LightRAG（知识图谱）**
- 工作目录
- 索引文件数
- 文件列表

**ChromaDB（向量库）**
- 集合名称
- 文档数量
- 持久化目录

#### 索引重建

**何时需要重建**：
- 手动修改了记忆文件
- 导入了新数据
- 索引损坏或性能下降

**操作步骤**：
1. 点击"重建 LightRAG 索引"或"重建 ChromaDB 索引"
2. 等待处理完成
3. 查看重建结果

⚠️ **注意**：重建可能需要几分钟，取决于数据量

#### 手动索引文档

直接索引单个文档：
1. 选择文档类型
2. 输入内容
3. 点击"索引文档"

#### 查询测试

测试检索效果：
1. 输入查询语句
2. 选择使用的索引器（LightRAG / ChromaDB）
3. 配置参数
4. 查看检索结果

## 🎨 UI 特性

### 响应式设计

- 自适应布局，支持各种屏幕尺寸
- 侧边栏菜单，快速切换页面

### 实时状态

侧边栏显示系统状态：
- ✅ API Key 已配置
- ✅ 代理已加载
- 📊 索引统计

### 美观界面

- 渐变色标题
- 卡片式布局
- 平滑过渡动画
- 清晰的视觉层次

## 🔧 高级配置

### 自定义样式

编辑 `app.py` 中的 CSS 部分：

```python
st.markdown("""
<style>
    .main-header {
        /* 自定义样式 */
    }
</style>
""", unsafe_allow_html=True)
```

### 添加新页面

1. 在 `pages/` 目录创建新文件
2. 实现 `render()` 函数
3. 在 `pages/__init__.py` 添加导入
4. 在 `app.py` 添加路由

### 修改问题框架

编辑 `questions/categories.md` 文件添加自定义问题类别

## 🐛 故障排查

### 常见问题

#### Q1: 应用启动失败

**错误**: `ModuleNotFoundError: No module named 'streamlit'`

**解决**:
```bash
pip install streamlit
```

#### Q2: API Key 错误

**错误**: "API Key 未配置"

**解决**:
- 检查 `.env` 文件是否存在
- 确认 `DEEPSEEK_API_KEY` 已设置
- 重启应用

#### Q3: 代理加载失败

**错误**: "代理未加载"

**解决**:
- 检查所有依赖是否安装
- 查看终端错误信息
- 确认目录结构正确

#### Q4: 记忆文件未找到

**错误**: "暂无XXX数据"

**解决**:
- 首次使用需要先在学习模式回答问题
- 检查 `memory/` 目录权限
- 确认文件路径正确

#### Q5: 可视化图表不显示

**解决**:
```bash
pip install plotly
```

## 📊 性能优化

### 提升响应速度

1. **减少检索范围**
   - 索引管理 > 查询测试
   - 降低 `chromadb_k` 参数

2. **使用缓存**
   - Streamlit 自动缓存部分数据
   - 避免频繁重建索引

3. **清理历史数据**
   - 定期归档旧对话
   - 删除无用的快照

### 降低内存占用

- 关闭不需要的浏览器标签
- 定期清除对话历史
- 使用"只使用最新记忆"选项

## 🔒 数据隐私

### 本地优先

- 所有记忆数据存储在本地
- ChromaDB 持久化到本地目录
- 对话记录不上传

### API 调用

唯一的外部请求：
- DeepSeek API（用于 LLM 推理和 Embedding）

可以离线使用部分功能：
- 记忆浏览
- 数据导出
- 索引查看

## 📚 学习路径建议

### 初次使用（第1天）

1. **学习模式** - 回答 5-10 个问题（覆盖不同类别）
2. **记忆浏览** - 查看提取的特征
3. **模拟模式** - 简单测试 AI 的理解

### 深入使用（第1周）

1. **学习模式** - 每天回答 3-5 个问题
2. **可视化** - 查看性格雷达图和价值观分布
3. **模拟模式** - 测试更复杂的问题

### 长期维护（第1月+）

1. **定期回答问题** - 保持记忆更新
2. **创建时间快照** - 记录思想演变
3. **分析演变趋势** - 使用分析代理

## 🎯 最佳实践

### 学习模式

✅ **每周至少回答 3-5 个问题**
- 保持记忆新鲜度
- 覆盖多个维度

✅ **诚实详细地回答**
- 提供具体例子
- 分享真实感受
- 不必担心对错

✅ **定期查看记忆**
- 验证提取的准确性
- 发现新的洞察

### 模拟模式

✅ **先积累足够数据**
- 至少回答 10-15 个问题
- 覆盖主要类别

✅ **多样化测试**
- 不同类型的问题
- 检验一致性

✅ **对比真实想法**
- 思考 AI 的回答是否符合你的思维
- 发现理解偏差

## 🔮 未来功能（开发中）

- [ ] 多用户支持
- [ ] 导出完整人物画像报告
- [ ] 更丰富的可视化图表
- [ ] 思想演变动画
- [ ] 与他人的对比分析
- [ ] 移动端适配
- [ ] 语音输入/输出

## 🤝 贡献

欢迎提交问题和建议！

- 报告 Bug: GitHub Issues
- 功能请求: GitHub Discussions
- 代码贡献: Pull Requests

## 📞 支持

如有问题：
1. 查看本文档
2. 查看 `HYBRID_RAG_GUIDE.md`
3. 查看终端错误日志
4. 提交 GitHub Issue

---

**享受探索自我的旅程！** 🧠✨
